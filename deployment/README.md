# Auto-deployment instructions

 - Create two webhooks: one for `/hooks/book-deploy-draft`, and one for `/hooks/book-deploy`.
    - Select only "Pipeline events" for both.
    - Leave SSL verification enabled.
    - Generate a random key and use it as a secret token.
 - Download the latest release of the `webhook` binary from [here](https://github.com/adnanh/webhook).
 - Extract the binary & copy it to `/srv/webhook` (the binary should be available at `/srv/webhook/webhook`)
 - Make the binary executable by running `sudo chmod +x /srv/webhook/webhook`
 - Create a system user for the webhook binary: `sudo useradd -r webhook`
 - Grant the newly created user the permission to write to the deployment directory:
    - `sudo find /var/web_server/htdocs -type d -exec chmod 775 {} +`
    - `sudo find /var/web_server/htdocs -type f -exec chmod 664 {} +`
    - `sudo chown -R webhook:root /var/web_server/htdocs`
 - Create the directory for `webhook` configuration files: `sudo mkdir -p /etc/webhook/`
 - Modify the `hooks.json` file to include the token you generated for the webhooks.
 - Copy the `webhook` configuration: `sudo cp hooks.json /etc/webhook/ && sudo chown webhook:root /etc/webhook/hooks.json && sudo chmod 640 /etc/webhook/hooks.json`
 - Copy the deployment script: `sudo cp deploy_artifact.sh /srv/webhook/`
 - Make the deployment script executable: `sudo chmod +x /srv/webhook/deploy_artifacts.sh`
 - Copy the systemd service file to the correct location: `sudo cp webhook.service /etc/systemd/system/ && sudo systemctl daemon-reload`
 - Run the service: `sudo systemctl --now enable webhook`
